"""remove_expected_end_date_add_charger_fields

Revision ID: a79c9c00921e
Revises: 4a2b8c9d5e6f
Create Date: 2025-09-01 22:46:35.360881

"""

from alembic import op
import sqlalchemy as sa
from sqlalchemy.dialects import mysql

# revision identifiers, used by Alembic.
revision = "a79c9c00921e"
down_revision = "4a2b8c9d5e6f"
branch_labels = None
depends_on = None


def upgrade():
    # ### commands auto generated by Alembic - please adjust! ###
    # Drop mentions table first (it has foreign key to comments)
    op.drop_table("mentions")

    # Then drop the comments table
    op.drop_table("comments")

    with op.batch_alter_table("evaluations", schema=None) as batch_op:
        batch_op.add_column(sa.Column("scs_charger_id", sa.Integer(), nullable=True))
        batch_op.add_column(
            sa.Column("head_office_charger_id", sa.Integer(), nullable=True)
        )
        batch_op.drop_constraint(batch_op.f("evaluations_ibfk_5"), type_="foreignkey")
        batch_op.drop_constraint(batch_op.f("evaluations_ibfk_4"), type_="foreignkey")
        batch_op.create_foreign_key(None, "users", ["head_office_charger_id"], ["id"])
        batch_op.create_foreign_key(None, "users", ["scs_charger_id"], ["id"])
        batch_op.drop_column("scs_colleague_id")
        batch_op.drop_column("head_officer_id")

    # ### end Alembic commands ###


def downgrade():
    # ### commands auto generated by Alembic - please adjust! ###
    with op.batch_alter_table("messages", schema=None) as batch_op:
        batch_op.add_column(
            sa.Column("comment_id", mysql.INTEGER(), autoincrement=False, nullable=True)
        )
        batch_op.create_foreign_key(
            batch_op.f("messages_ibfk_3"), "comments", ["comment_id"], ["id"]
        )

    with op.batch_alter_table("evaluations", schema=None) as batch_op:
        batch_op.add_column(
            sa.Column(
                "head_officer_id", mysql.INTEGER(), autoincrement=False, nullable=True
            )
        )
        batch_op.add_column(
            sa.Column(
                "scs_colleague_id", mysql.INTEGER(), autoincrement=False, nullable=True
            )
        )
        batch_op.drop_constraint(None, type_="foreignkey")
        batch_op.drop_constraint(None, type_="foreignkey")
        batch_op.create_foreign_key(
            batch_op.f("evaluations_ibfk_4"), "users", ["head_officer_id"], ["id"]
        )
        batch_op.create_foreign_key(
            batch_op.f("evaluations_ibfk_5"), "users", ["scs_colleague_id"], ["id"]
        )
        batch_op.drop_column("head_office_charger_id")
        batch_op.drop_column("scs_charger_id")

    op.create_table(
        "mentions",
        sa.Column("id", mysql.INTEGER(), autoincrement=True, nullable=False),
        sa.Column(
            "mention_type",
            mysql.ENUM(
                "evaluation_comment",
                "evaluation_description",
                "message",
                "task_assignment",
            ),
            nullable=False,
        ),
        sa.Column(
            "mentioned_user_id", mysql.INTEGER(), autoincrement=False, nullable=False
        ),
        sa.Column("mentioner_id", mysql.INTEGER(), autoincrement=False, nullable=False),
        sa.Column("evaluation_id", mysql.INTEGER(), autoincrement=False, nullable=True),
        sa.Column("message_id", mysql.INTEGER(), autoincrement=False, nullable=True),
        sa.Column("comment_id", mysql.INTEGER(), autoincrement=False, nullable=True),
        sa.Column(
            "context_text", mysql.TEXT(collation="utf8mb4_unicode_ci"), nullable=True
        ),
        sa.Column(
            "mention_position", mysql.INTEGER(), autoincrement=False, nullable=True
        ),
        sa.Column(
            "status", mysql.ENUM("unread", "read", "acknowledged"), nullable=False
        ),
        sa.Column("read_at", mysql.DATETIME(), nullable=True),
        sa.Column("acknowledged_at", mysql.DATETIME(), nullable=True),
        sa.Column("created_at", mysql.DATETIME(), nullable=False),
        sa.ForeignKeyConstraint(
            ["comment_id"], ["comments.id"], name=op.f("mentions_ibfk_5")
        ),
        sa.ForeignKeyConstraint(
            ["evaluation_id"], ["evaluations.id"], name=op.f("mentions_ibfk_3")
        ),
        sa.ForeignKeyConstraint(
            ["mentioned_user_id"], ["users.id"], name=op.f("mentions_ibfk_1")
        ),
        sa.ForeignKeyConstraint(
            ["mentioner_id"], ["users.id"], name=op.f("mentions_ibfk_2")
        ),
        sa.ForeignKeyConstraint(
            ["message_id"], ["messages.id"], name=op.f("mentions_ibfk_4")
        ),
        sa.PrimaryKeyConstraint("id"),
        mysql_collate="utf8mb4_unicode_ci",
        mysql_default_charset="utf8mb4",
        mysql_engine="InnoDB",
    )
    op.create_table(
        "comments",
        sa.Column("id", mysql.INTEGER(), autoincrement=True, nullable=False),
        sa.Column(
            "evaluation_id", mysql.INTEGER(), autoincrement=False, nullable=False
        ),
        sa.Column("user_id", mysql.INTEGER(), autoincrement=False, nullable=False),
        sa.Column(
            "parent_comment_id", mysql.INTEGER(), autoincrement=False, nullable=True
        ),
        sa.Column(
            "content", mysql.TEXT(collation="utf8mb4_unicode_ci"), nullable=False
        ),
        sa.Column(
            "is_edited",
            mysql.TINYINT(display_width=1),
            autoincrement=False,
            nullable=False,
        ),
        sa.Column("edited_at", mysql.DATETIME(), nullable=True),
        sa.Column(
            "is_deleted",
            mysql.TINYINT(display_width=1),
            autoincrement=False,
            nullable=False,
        ),
        sa.Column("deleted_at", mysql.DATETIME(), nullable=True),
        sa.Column("created_at", mysql.DATETIME(), nullable=False),
        sa.Column("updated_at", mysql.DATETIME(), nullable=False),
        sa.ForeignKeyConstraint(
            ["evaluation_id"],
            ["evaluations.id"],
            name=op.f("comments_ibfk_1"),
            ondelete="CASCADE",
        ),
        sa.ForeignKeyConstraint(
            ["parent_comment_id"],
            ["comments.id"],
            name=op.f("comments_ibfk_3"),
            ondelete="CASCADE",
        ),
        sa.ForeignKeyConstraint(
            ["user_id"], ["users.id"], name=op.f("comments_ibfk_2"), ondelete="CASCADE"
        ),
        sa.PrimaryKeyConstraint("id"),
        mysql_collate="utf8mb4_unicode_ci",
        mysql_default_charset="utf8mb4",
        mysql_engine="InnoDB",
    )
    # ### end Alembic commands ###
